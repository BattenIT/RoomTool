<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UVA Batten School Room Dashboard</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            /* Modern Color Palette */
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --uva-gradient: linear-gradient(135deg, #232d4b 0%, #e57200 100%);
            --accent-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            
            /* Neutral Colors */
            --bg-primary: #fafbfc;
            --bg-secondary: #f8f9fb;
            --bg-card: rgba(255, 255, 255, 0.95);
            --bg-glass: rgba(255, 255, 255, 0.1);
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --border-light: rgba(255, 255, 255, 0.2);
            --border-subtle: #e2e8f0;
            --shadow-soft: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-medium: 0 8px 30px rgba(0, 0, 0, 0.12);
            --shadow-strong: 0 20px 60px rgba(0, 0, 0, 0.15);
            
            /* Status Colors */
            --status-available: #10b981;
            --status-busy: #ef4444;
            --status-partial: #f59e0b;
            --status-unknown: #6b7280;
            
            /* UVA Colors */
            --uva-navy: #232d4b;
            --uva-orange: #e57200;
            --uva-light-blue: #4facfe;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #232D4B 0%, #4F8CC9 100%);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: var(--shadow-strong);
            border: 1px solid var(--border-light);
            overflow: hidden;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        header {
            background: var(--uva-orange);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Ccircle cx='30' cy='30' r='4'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
            opacity: 0.3;
        }
        
        h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .subtitle {
            font-size: 1.2rem;
            font-weight: 400;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(248,249,251,0.9) 100%);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-subtle);
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--bg-card);
            padding: 12px 20px;
            border-radius: 16px;
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--border-subtle);
            transition: all 0.3s ease;
        }
        
        .control-group:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        label {
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        select, input[type="date"] {
            padding: 12px 16px;
            border: 2px solid var(--border-subtle);
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            background: white;
            color: var(--text-primary);
            transition: all 0.3s ease;
            min-width: 140px;
        }
        
        select:focus, input[type="date"]:focus {
            outline: none;
            border-color: var(--uva-orange);
            box-shadow: 0 0 0 3px rgba(229, 114, 0, 0.1);
            transform: translateY(-1px);
        }
        
        .view-toggle {
            display: flex;
            background: var(--bg-card);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--border-subtle);
            position: relative;
        }
        
        .view-btn {
            padding: 14px 24px;
            background: transparent;
            color: var(--text-secondary);
            border: none;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }
        
        .view-btn:hover {
            color: var(--text-primary);
            background: rgba(103, 126, 234, 0.1);
        }
        
        .view-btn.active {
            color: white;
            background: var(--uva-gradient);
            box-shadow: 0 2px 8px rgba(229, 114, 0, 0.3);
        }
        
        .dashboard {
            padding: 30px;
            background: var(--bg-primary);
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--border-subtle);
            transition: all 0.3s ease;
        }
        
        .status-bar:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .status-info {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .status-info::before {
            content: 'üìä';
            font-size: 1.3rem;
        }
        
        .last-updated {
            font-size: 0.9rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .last-updated::before {
            content: 'üïê';
            font-size: 1rem;
        }
        
        /* Modern Card-Based Day View */
        .day-view {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .time-header-modern {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .time-slots-header {
            display: flex;
            gap: 8px;
            background: var(--bg-card);
            padding: 16px 24px;
            border-radius: 20px;
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--border-subtle);
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .time-slot-header {
            padding: 8px 16px;
            background: var(--primary-gradient);
            color: white;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            min-width: 60px;
            text-align: center;
        }
        
        .rooms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
        }
        
        .room-card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 24px;
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--border-subtle);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }
        
        .room-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--success-gradient);
            border-radius: 24px 24px 0 0;
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }
        
        .room-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-strong);
        }
        
        .room-card:hover::before {
            transform: scaleX(1);
        }
        
        .room-card.has-events::before {
            background: var(--accent-gradient);
            transform: scaleX(1);
        }
        
        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border-subtle);
        }
        
        .room-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .room-icon {
            font-size: 1.5rem;
        }
        
        .room-status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .room-status-available {
            background: linear-gradient(135deg, #10b981, #34d399);
            color: white;
        }
        
        .room-status-busy {
            background: linear-gradient(135deg, #ef4444, #f87171);
            color: white;
        }
        
        .room-status-partial {
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            color: white;
        }
        
        .room-schedule {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .time-slot-row {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 16px;
            border-radius: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .time-slot-row:hover {
            background: rgba(103, 126, 234, 0.05);
            border-color: rgba(103, 126, 234, 0.2);
        }
        
        .time-slot-time {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-secondary);
            min-width: 80px;
            text-align: center;
            padding: 8px 12px;
            background: var(--bg-secondary);
            border-radius: 10px;
        }
        
        .time-slot-content {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .time-slot-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .status-available {
            background: var(--status-available);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
        }
        
        .status-busy {
            background: var(--status-busy);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
        }
        
        .time-slot-event {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .time-slot-free {
            font-size: 0.9rem;
            color: var(--text-muted);
            font-style: italic;
        }
        
        /* Modern Week View Styles */
        .week-view {
            display: grid;
            grid-template-columns: 140px repeat(7, 1fr);
            gap: 16px;
            padding: 20px;
            background: var(--bg-card);
            border-radius: 24px;
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--border-subtle);
        }
        
        .week-header-cell {
            background: var(--primary-gradient);
            color: white;
            padding: 20px 16px;
            text-align: center;
            font-weight: 600;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(103, 126, 234, 0.3);
        }
        
        .day-header {
            background: var(--bg-card);
            padding: 20px 16px;
            text-align: center;
            font-weight: 600;
            border-radius: 16px;
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--border-subtle);
            transition: all 0.3s ease;
        }
        
        .day-header:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .day-cell {
            background: var(--bg-card);
            padding: 16px;
            min-height: 100px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-soft);
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .day-cell:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-medium);
            border-color: rgba(103, 126, 234, 0.3);
        }
        
        .day-cell.has-events {
            background: linear-gradient(135deg, rgba(229, 114, 0, 0.1) 0%, rgba(255, 140, 66, 0.1) 100%);
            border-color: var(--uva-orange);
        }
        
        .event-count {
            background: var(--uva-gradient);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(229, 114, 0, 0.3);
            align-self: flex-start;
        }
        
        /* Modern Month View Styles */
        .month-view {
            background: var(--bg-card);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--border-subtle);
        }
        
        .month-header {
            background: var(--uva-gradient);
            color: white;
            padding: 30px;
            text-align: center;
            font-size: 1.6rem;
            font-weight: 700;
            position: relative;
        }
        
        .month-header::before {
            content: 'üìÖ';
            position: absolute;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2rem;
        }
        
        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: var(--bg-secondary);
            gap: 1px;
        }
        
        .weekday {
            padding: 16px;
            text-align: center;
            font-weight: 600;
            color: var(--text-primary);
            background: var(--bg-card);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--bg-secondary);
        }
        
        .calendar-day {
            background: var(--bg-card);
            padding: 16px;
            min-height: 120px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .calendar-day:hover {
            transform: scale(1.02);
            box-shadow: var(--shadow-medium);
            border-color: rgba(103, 126, 234, 0.3);
            z-index: 10;
        }
        
        .calendar-day.other-month {
            background: var(--bg-secondary);
            color: var(--text-muted);
            opacity: 0.6;
        }
        
        .calendar-day.has-events {
            background: linear-gradient(135deg, rgba(229, 114, 0, 0.1) 0%, rgba(255, 140, 66, 0.1) 100%);
            border-color: var(--uva-orange);
        }
        
        .day-number {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-primary);
            align-self: flex-start;
        }
        
        .day-events {
            font-size: 0.8rem;
            color: var(--uva-orange);
            font-weight: 600;
            background: rgba(229, 114, 0, 0.1);
            padding: 4px 8px;
            border-radius: 8px;
            align-self: flex-start;
        }
        
        /* Loading and Error States */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 40px;
            color: var(--text-muted);
            background: var(--bg-card);
            border-radius: 24px;
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--border-subtle);
            margin: 20px;
        }
        
        .loading::before {
            content: '‚è≥';
            font-size: 3rem;
            margin-bottom: 16px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(248, 113, 113, 0.1) 100%);
            color: var(--text-primary);
            padding: 30px;
            border-radius: 24px;
            margin: 20px;
            text-align: center;
            border: 2px solid rgba(239, 68, 68, 0.2);
            box-shadow: var(--shadow-soft);
        }
        
        .error::before {
            content: '‚ö†Ô∏è';
            font-size: 2rem;
            display: block;
            margin-bottom: 12px;
        }
        
        .success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(52, 211, 153, 0.1) 100%);
            color: var(--text-primary);
            padding: 30px;
            border-radius: 24px;
            margin: 20px;
            text-align: center;
            border: 2px solid rgba(16, 185, 129, 0.2);
            box-shadow: var(--shadow-soft);
        }
        
        .success::before {
            content: '‚úÖ';
            font-size: 2rem;
            display: block;
            margin-bottom: 12px;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Modern Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-strong);
            border: 1px solid var(--border-light);
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border-subtle);
        }
        
        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            background: var(--uva-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .modal-close {
            background: var(--bg-secondary);
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 12px;
            border-radius: 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
        }
        
        .modal-close:hover {
            background: var(--uva-gradient);
            color: white;
            transform: rotate(90deg);
        }
        
        .event-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .event-item {
            background: var(--bg-card);
            border: 2px solid var(--border-subtle);
            padding: 20px;
            border-radius: 16px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .event-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--uva-gradient);
        }
        
        .event-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
            border-color: var(--uva-orange);
        }
        
        .event-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .event-time {
            color: var(--uva-orange);
            font-weight: 500;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .event-time::before {
            content: 'üïê';
            font-size: 1rem;
        }
        
        .event-location {
            color: var(--text-muted);
            font-style: italic;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .event-location::before {
            content: 'üìç';
            font-size: 1rem;
        }
        
        .no-events {
            text-align: center;
            color: var(--text-muted);
            font-style: italic;
            padding: 40px 20px;
        }
        
        .no-events::before {
            content: 'üìÖ';
            font-size: 3rem;
            display: block;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 180px;
            height: 56px;
            background: linear-gradient(135deg, #e57200 0%, #ff8c42 100%);
            color: white;
            border: none;
            border-radius: 28px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(229, 114, 0, 0.4);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 600;
            font-size: 14px;
            z-index: 1000;
        }
        
        .fab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(229, 114, 0, 0.6);
            background: linear-gradient(135deg, #d46500 0%, #e57200 100%);
        }
        
        .fab:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(229, 114, 0, 0.4);
        }
        
        .fab-icon {
            font-size: 18px;
        }
        
        .fab-text {
            font-size: 14px;
            white-space: nowrap;
        }
        
        /* Available Rooms List */
        .available-rooms-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .available-room-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s ease;
        }
        
        .available-room-item:hover {
            background-color: #f8f9fa;
        }
        
        .available-room-item:last-child {
            border-bottom: none;
        }
        
        .room-info {
            flex: 1;
        }
        
        .room-name-available {
            font-weight: 600;
            color: #232d4b;
            margin-bottom: 4px;
        }
        
        .room-status {
            font-size: 0.9rem;
            color: #28a745;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .room-status-icon {
            width: 8px;
            height: 8px;
            background-color: #28a745;
            border-radius: 50%;
        }
        
        .next-event {
            font-size: 0.8rem;
            color: #666;
            margin-top: 2px;
        }
        
        .no-available-rooms {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px 20px;
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 1024px) {
            .rooms-grid {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
            }
            
            .controls {
                flex-direction: column;
                gap: 20px;
                align-items: stretch;
            }
            
            .control-group {
                justify-content: center;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 20px;
            }
            
            header {
                padding: 30px 20px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .subtitle {
                font-size: 1.1rem;
            }
            
            .controls {
                padding: 20px;
                gap: 16px;
            }
            
            .dashboard {
                padding: 20px;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 12px;
                text-align: center;
                padding: 16px 20px;
            }
            
            .rooms-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .room-card {
                padding: 20px;
            }
            
            .room-name {
                font-size: 1.2rem;
            }
            
            .time-slot-row {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
                text-align: center;
            }
            
            .time-slot-time {
                min-width: auto;
            }
            
            .week-view {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .month-view .calendar-day {
                min-height: 80px;
                padding: 12px;
            }
            
            .modal-content {
                padding: 20px;
                margin: 10px;
                max-width: calc(100vw - 20px);
            }
            
            .modal-title {
                font-size: 1.4rem;
            }
            
            .fab {
                width: 56px;
                height: 56px;
                border-radius: 28px;
                bottom: 20px;
                right: 20px;
            }
            
            .fab-text {
                display: none;
            }
            
            .fab-icon {
                font-size: 20px;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .controls {
                padding: 16px;
            }
            
            .dashboard {
                padding: 16px;
            }
            
            .view-btn {
                padding: 12px 16px;
                font-size: 0.8rem;
            }
            
            .room-card {
                padding: 16px;
            }
            
            .time-slots-header {
                padding: 12px 16px;
                gap: 6px;
            }
            
            .time-slot-header {
                padding: 6px 12px;
                font-size: 0.8rem;
                min-width: 50px;
            }
        }
        
        .collapse-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background: white;
            color: #374151;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            margin: 0 0.25rem;
        }
        
        .collapse-btn:hover {
            background: #f9fafb;
            border-color: #9ca3af;
        }
        
        .collapse-btn:active {
            background: #f3f4f6;
        }
        
        .collapse-btn#expandAllBtn {
            background: #232d4b;
            color: white;
            border-color: #232d4b;
        }
        
        .collapse-btn#expandAllBtn:hover {
            background: #1e293f;
            border-color: #1e293f;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
                <img src="https://battenprojects.com/images/bat_rgb_ko.png" alt="Batten School Logo" style="height: 135px; filter: brightness(0) invert(1); margin-bottom: 16px;">
                <div style="font-size: 1.4rem; font-weight: 600; color: white; margin-bottom: 8px;">BattenSpace</div>
                <div class="subtitle">Live room booking status</div>
            </div>
        </header>
        
        <div class="controls">
            <div class="control-group">
                <label for="dateSelect">Date:</label>
                <input type="date" id="dateSelect">
            </div>
            
            <div class="view-toggle">
                <button class="view-btn active" id="dayBtn">Day</button>
                <button class="view-btn" id="weekBtn">Week</button>
                <button class="view-btn" id="monthBtn">Month</button>
            </div>
            
            <div class="control-group">
                <label for="roomFilter">Room:</label>
                <select id="roomFilter">
                    <option value="">All Rooms</option>
                </select>
            </div>
            
            <div class="control-group">
                <button id="expandAllBtn" class="collapse-btn">Expand All</button>
                <button id="collapseAllBtn" class="collapse-btn">Collapse All</button>
            </div>
        </div>
        
        
        <div class="dashboard">
            <div id="dayView" class="day-view"></div>
            <div id="weekView" class="week-view hidden"></div>
            <div id="monthView" class="month-view hidden"></div>
            <div id="loadingMsg" class="loading hidden">Loading room schedules...</div>
            <div id="errorMsg" class="error hidden"></div>
        </div>
    </div>
    
    <!-- Find Available Rooms Floating Action Button -->
    <button id="findAvailableBtn" class="fab" title="Find Available Rooms">
        <span class="fab-icon">üîç</span>
        <span class="fab-text">Find Available Rooms</span>
    </button>
    
    <!-- Available Rooms Modal -->
    <div id="availableRoomsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Find Available Rooms</h3>
                <button class="modal-close" id="availableRoomsClose">&times;</button>
            </div>
            
            <!-- Search Controls -->
            <div style="padding: 20px; border-bottom: 2px solid var(--border-subtle); margin-bottom: 20px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="control-group">
                        <label for="searchDate">Date:</label>
                        <input type="date" id="searchDate" style="padding: 10px; border: 2px solid var(--border-subtle); border-radius: 8px;">
                    </div>
                    <div class="control-group">
                        <label for="searchDuration">Duration:</label>
                        <select id="searchDuration" style="padding: 10px; border: 2px solid var(--border-subtle); border-radius: 8px;">
                            <option value="30">30 minutes</option>
                            <option value="60" selected>1 hour</option>
                            <option value="90">1.5 hours</option>
                            <option value="120">2 hours</option>
                            <option value="custom">Custom...</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div class="control-group">
                        <label for="searchStartTime">Start Time:</label>
                        <select id="searchStartTime" style="padding: 10px; border: 2px solid var(--border-subtle); border-radius: 8px;">
                            <!-- Time options will be populated by JavaScript -->
                        </select>
                    </div>
                    <div class="control-group" id="customEndTimeGroup" style="display: none;">
                        <label for="searchEndTime">End Time:</label>
                        <select id="searchEndTime" style="padding: 10px; border: 2px solid var(--border-subtle); border-radius: 8px;">
                            <!-- Time options will be populated by JavaScript -->
                        </select>
                    </div>
                    <div style="display: flex; align-items: end;">
                        <button id="searchRoomsBtn" style="padding: 12px 24px; background: var(--uva-orange); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; width: 100%;">
                            Search Rooms
                        </button>
                    </div>
                </div>
            </div>
            
            <div id="availableRoomsList" class="available-rooms-list">
                <div style="text-align: center; color: var(--text-muted); padding: 40px;">
                    Select date, time, and duration above to find available rooms.
                </div>
            </div>
        </div>
    </div>
    
    <!-- Event Details Modal -->
    <div id="eventModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Events</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <ul class="event-list" id="eventList"></ul>
        </div>
    </div>

    <script src="ics-parser.js?t=1724879500"></script>
    <script>
        class RoomDashboard {
            constructor() {
                this.currentView = 'day';
                this.currentDate = new Date(); // Default to current date
                this.parser = new ICSParser();
                this.events = [];
                this.rooms = new Set();
                this.isLiveData = false;
                
                // UVA Calendar URL
                this.calendarUrl = 'https://outlook.office365.com/owa/calendar/cf706332e50c45009e2b3164e0b68ca0@virginia.edu/6960c19164584f9cbb619329600a490a16019380931273154626/calendar.ics';
                
                this.init();
            }
            
            init() {
                this.bindElements();
                this.bindEvents();
                this.setDefaultDate();
                this.loadCalendarData();
            }
            
            bindElements() {
                this.dateSelect = document.getElementById('dateSelect');
                this.roomFilter = document.getElementById('roomFilter');
                this.dayBtn = document.getElementById('dayBtn');
                this.weekBtn = document.getElementById('weekBtn');
                this.monthBtn = document.getElementById('monthBtn');
                this.dayView = document.getElementById('dayView');
                this.weekView = document.getElementById('weekView');
                this.monthView = document.getElementById('monthView');
                this.loadingMsg = document.getElementById('loadingMsg');
                this.errorMsg = document.getElementById('errorMsg');
                this.eventModal = document.getElementById('eventModal');
                this.modalTitle = document.getElementById('modalTitle');
                this.modalClose = document.getElementById('modalClose');
                this.eventList = document.getElementById('eventList');
                
                // Find Available Room elements
                this.findAvailableBtn = document.getElementById('findAvailableBtn');
                this.availableRoomsModal = document.getElementById('availableRoomsModal');
                this.availableRoomsClose = document.getElementById('availableRoomsClose');
                this.availableRoomsList = document.getElementById('availableRoomsList');
                this.searchDate = document.getElementById('searchDate');
                this.searchStartTime = document.getElementById('searchStartTime');
                this.searchEndTime = document.getElementById('searchEndTime');
                this.searchDuration = document.getElementById('searchDuration');
                this.searchRoomsBtn = document.getElementById('searchRoomsBtn');
                this.customEndTimeGroup = document.getElementById('customEndTimeGroup');
            }
            
            bindEvents() {
                this.dateSelect.addEventListener('change', (e) => {
                    console.log('Date change event triggered');
                    this.handleDateChange(e);
                });
                this.roomFilter.addEventListener('change', () => this.render());
                this.dayBtn.addEventListener('click', () => this.switchView('day'));
                this.weekBtn.addEventListener('click', () => this.switchView('week'));
                this.monthBtn.addEventListener('click', () => this.switchView('month'));
                
                // Modal events
                this.modalClose.addEventListener('click', () => this.closeModal());
                this.eventModal.addEventListener('click', (e) => {
                    if (e.target === this.eventModal) this.closeModal();
                });
                
                // ESC key to close modal
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && !this.eventModal.classList.contains('hidden')) {
                        this.closeModal();
                    }
                    if (e.key === 'Escape' && !this.availableRoomsModal.classList.contains('hidden')) {
                        this.closeAvailableRoomsModal();
                    }
                });
                
                // Find Available Room button events
                this.findAvailableBtn.addEventListener('click', () => this.showAvailableRoomsModal());
                this.availableRoomsClose.addEventListener('click', () => this.closeAvailableRoomsModal());
                this.availableRoomsModal.addEventListener('click', (e) => {
                    if (e.target === this.availableRoomsModal) this.closeAvailableRoomsModal();
                });
                
                // Search form events
                this.searchDuration.addEventListener('change', () => this.handleDurationChange());
                this.searchRoomsBtn.addEventListener('click', () => this.performRoomSearch());
            }
            
            setDefaultDate() {
                this.dateSelect.value = this.currentDate.toISOString().split('T')[0];
            }
            
            initializeSearchForm() {
                // Set default search date to today
                const today = new Date().toISOString().split('T')[0];
                this.searchDate.value = today;
                
                // Populate time dropdowns
                this.populateTimeDropdowns();
                
                // Set default start time to current hour
                const currentHour = new Date().getHours();
                const defaultStartHour = Math.max(8, Math.min(19, currentHour));
                this.searchStartTime.value = `${defaultStartHour.toString().padStart(2, '0')}:00`;
            }
            
            populateTimeDropdowns() {
                // Clear existing options
                this.searchStartTime.innerHTML = '';
                this.searchEndTime.innerHTML = '';
                
                // Generate time options from 8 AM to 8 PM
                for (let hour = 8; hour <= 20; hour++) {
                    const hour12 = hour > 12 ? hour - 12 : hour;
                    const ampm = hour >= 12 ? 'PM' : 'AM';
                    const displayHour = hour12 === 0 ? 12 : hour12;
                    const display = `${displayHour}:00 ${ampm}`;
                    const value = `${hour.toString().padStart(2, '0')}:00`;
                    
                    // Start time options (8 AM - 7 PM)
                    if (hour <= 19) {
                        const startOption = document.createElement('option');
                        startOption.value = value;
                        startOption.textContent = display;
                        this.searchStartTime.appendChild(startOption);
                    }
                    
                    // End time options (9 AM - 8 PM)
                    if (hour >= 9) {
                        const endOption = document.createElement('option');
                        endOption.value = value;
                        endOption.textContent = display;
                        this.searchEndTime.appendChild(endOption);
                    }
                }
            }
            
            handleDurationChange() {
                const isCustom = this.searchDuration.value === 'custom';
                this.customEndTimeGroup.style.display = isCustom ? 'block' : 'none';
                
                if (!isCustom) {
                    // Auto-calculate end time based on duration
                    const startTime = this.searchStartTime.value;
                    const duration = parseInt(this.searchDuration.value);
                    
                    if (startTime && duration) {
                        const [startHour, startMinute] = startTime.split(':').map(Number);
                        const endHour = startHour + Math.floor(duration / 60);
                        const endMinute = startMinute + (duration % 60);
                        
                        const finalEndHour = endHour + Math.floor(endMinute / 60);
                        const finalEndMinute = endMinute % 60;
                        
                        const endTimeValue = `${finalEndHour.toString().padStart(2, '0')}:${finalEndMinute.toString().padStart(2, '0')}`;
                        this.searchEndTime.value = endTimeValue;
                    }
                }
            }
            
            async loadCalendarData() {
                this.showLoading(true);
                
                // Try to load from local ICS files first - load all available files
                const icsFiles = ['GreatHall.ics', 'ConfA.ics', 'SeminarRoom.ics'];
                let loadedAnyFile = false;
                
                for (const fileName of icsFiles) {
                    try {
                        console.log(`Attempting to load ${fileName}...`);
                        const response = await fetch(`ics/${fileName}`);
                        if (response.ok) {
                            const icsData = await response.text();
                            console.log(`Successfully loaded ${fileName}`);
                            this.parseICSDataWithRobustParser(icsData);
                            loadedAnyFile = true;
                        } else {
                            console.warn(`Failed to load ${fileName}: ${response.status} ${response.statusText}`);
                        }
                    } catch (error) {
                        console.error(`Could not load ${fileName}:`, error.message);
                        
                        // Specific CORS error guidance
                        if (error.message.includes('CORS') || error.message.includes('fetch')) {
                            console.error(`‚ùå CORS Issue Detected!`);
                            console.error(`To fix this, run the dashboard from a local server:`);
                            console.error(`1. Open terminal in the project directory`);
                            console.error(`2. Run: python -m http.server 8000`);
                            console.error(`3. Open: http://localhost:8000/room-dashboard.html`);
                        }
                    }
                }
                
                if (loadedAnyFile) {
                    this.isLiveData = true;
                    this.updateRoomFilter();
                    this.render();
                    this.showLoading(false);
                    return;
                }
                
                // TEMPORARILY DISABLE localStorage to debug room assignment
                // First check if we have locally stored calendar data
                const storedData = null; // localStorage.getItem('uvaCalendarData');
                if (storedData) {
                    try {
                        const events = JSON.parse(storedData);
                        // Convert date strings back to Date objects
                        events.forEach(event => {
                            event.startTime = new Date(event.startTime);
                            event.endTime = new Date(event.endTime);
                        });
                        
                        this.events = events;
                        // Extract actual room names from the events, filtering out unwanted ones
                        const validRooms = events
                            .map(event => event.room)
                            .filter(room => room && 
                                room !== 'Events Without Room' && 
                                room !== 'Unknown Room' &&
                                room !== 'Great Hall' &&  // We want numbered rooms, not just 'Great Hall'
                                room !== 'Seminar Room' &&  // We want numbered rooms, not just 'Seminar Room'
                                (room.includes('Great Hall') || room.includes('Seminar Room') || room.includes('Conference Room A')) // Keep all room types with numbers
                            );
                        this.rooms = new Set(validRooms);
                        this.isLiveData = true;
                        
                        console.log('Loaded calendar data from local storage');
                        console.log('Events loaded:', this.events.length);
                        
                        this.updateRoomFilter();
                        this.render();
                        this.showLoading(false);
                        return;
                    } catch (error) {
                        console.warn('Failed to parse stored calendar data:', error);
                        localStorage.removeItem('uvaCalendarData');
                    }
                }
                
                // Show helpful error message with solution
                const errorMsg = `No calendar data available. 
                
To load your calendar data:
1. Open simple-dashboard.html in your browser
2. Drag and drop your GreatHall.ics file into the drop zone
3. The data will be parsed and stored
4. Return to this room-dashboard.html - it will show your events

Note: Browser security prevents direct file loading. Use the simple dashboard first to process your .ics file.`;
                
                this.showError(errorMsg);
            }

            parseICSDataWithRobustParser(icsData) {
                console.log('Using robust ICS parser...');
                const result = this.parser.parseICS(icsData);
                this.events = result.events;
                this.rooms = new Set(result.rooms);
                
                console.log(`Parsed ${this.events.length} events from ${this.rooms.size} rooms`);
                console.log('All extracted rooms:', Array.from(this.rooms));
                console.log('Debug info:', this.parser.getDebugInfo());
                
                // Specific ConfA debugging
                const confAEvents = this.events.filter(e => e.room && e.room.includes('Conference Room A'));
                console.log(`Found ${confAEvents.length} Conference Room A events:`);
                confAEvents.forEach((event, i) => {
                    console.log(`${i+1}. "${event.summary}" - Room: "${event.room}" - ${event.startTime.toDateString()}`);
                });
                
                // Check if Conference Room A is in the rooms set
                const confARooms = Array.from(this.rooms).filter(room => room && room.includes('Conference Room A'));
                console.log(`Conference Room A rooms in dropdown:`, confARooms);
                
                if (confAEvents.length > 0 && confARooms.length === 0) {
                    console.error('‚ùå ISSUE: Found ConfA events but no ConfA rooms in dropdown!');
                    console.error('First ConfA event room name:', `"${confAEvents[0].room}"`);
                    console.error('All rooms:', Array.from(this.rooms));
                }
            }
            
            
            createSampleData() {
                const today = new Date();
                const rooms = [
                    'Great Hall'
                ];
                
                this.events = [];
                
                // Generate sample events for the next 30 days
                for (let day = 0; day < 30; day++) {
                    const eventDate = new Date(today);
                    eventDate.setDate(today.getDate() + day);
                    
                    // Skip weekends for most events
                    if (eventDate.getDay() === 0 || eventDate.getDay() === 6) continue;
                    
                    // Create 3-8 random events per day
                    const eventCount = 3 + Math.floor(Math.random() * 6);
                    
                    for (let i = 0; i < eventCount; i++) {
                        const room = rooms[Math.floor(Math.random() * rooms.length)];
                        const startHour = 8 + Math.floor(Math.random() * 10); // 8 AM to 6 PM
                        const duration = 1 + Math.floor(Math.random() * 3); // 1-3 hours
                        
                        const startTime = new Date(eventDate);
                        startTime.setHours(startHour, 0, 0, 0);
                        
                        const endTime = new Date(startTime);
                        endTime.setHours(startHour + duration);
                        
                        const eventNames = [
                            'Morning Meeting',
                            'Project Review', 
                            'Training Session',
                            'Faculty Meeting',
                            'Student Orientation',
                            'Board Meeting',
                            'Guest Lecture',
                            'Policy Workshop',
                            'Research Presentation',
                            'Alumni Event'
                        ];
                        const eventName = eventNames[Math.floor(Math.random() * eventNames.length)];
                        
                        this.events.push({
                            summary: eventName,
                            startTime: startTime,
                            endTime: endTime,
                            room: room,
                            location: room
                        });
                        
                        this.rooms.add(room);
                    }
                }
                
                // Sort events by start time
                this.events.sort((a, b) => a.startTime - b.startTime);
            }
            
            
            updateRoomFilter() {
                // Clear existing options
                while (this.roomFilter.children.length > 1) {
                    this.roomFilter.removeChild(this.roomFilter.lastChild);
                }
                
                // Add room options
                Array.from(this.rooms).sort().forEach(room => {
                    const option = document.createElement('option');
                    option.value = room;
                    option.textContent = room;
                    this.roomFilter.appendChild(option);
                });
            }
            
            handleDateChange(e) {
                const dateValue = e.target.value;
                console.log('Date input value:', dateValue);
                
                // Parse date correctly to avoid timezone issues
                const [year, month, day] = dateValue.split('-');
                this.currentDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
                
                console.log('Date changed to:', this.currentDate.toDateString());
                this.render();
            }
            
            switchView(viewType) {
                this.currentView = viewType;
                
                // Update button states
                document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(`${viewType}Btn`).classList.add('active');
                
                // Show/hide views
                this.dayView.classList.toggle('hidden', viewType !== 'day');
                this.weekView.classList.toggle('hidden', viewType !== 'week');
                this.monthView.classList.toggle('hidden', viewType !== 'month');
                
                this.render();
            }
            
            render() {
                switch (this.currentView) {
                    case 'day':
                        this.renderDayView();
                        break;
                    case 'week':
                        this.renderWeekView();
                        break;
                    case 'month':
                        this.renderMonthView();
                        break;
                }
            }
            
            renderDayView() {
                const selectedRoom = this.roomFilter.value;
                const targetDate = this.currentDate.toDateString();
                
                console.log(`=== MODERN RENDER DAY VIEW DEBUG ===`);
                console.log(`Current date object:`, this.currentDate);
                console.log(`Target date string: "${targetDate}"`);
                console.log(`Total events loaded:`, this.events.length);
                
                // Debug: Show what date we're rendering and what events exist for that date
                const eventsForDate = this.getEventsForDate(targetDate);
                console.log(`üìÖ DATE FILTERING DEBUG for ${targetDate}:`);
                console.log(`Events found for this date:`, eventsForDate.map(e => `"${e.summary}" in "${e.room}"`));
                console.log(`Available rooms:`, Array.from(this.rooms));
                console.log(`Selected room filter:`, this.roomFilter.value);
                
                const confAEvents = this.events.filter(e => e.room && e.room.includes('Conference Room A'));
                console.log(`üìç All ConfA events in system:`, confAEvents.map(e => ({
                    summary: e.summary,
                    room: e.room,
                    date: e.startTime.toDateString(),
                    time: e.startTime.toLocaleTimeString() + ' - ' + e.endTime.toLocaleTimeString()
                })));
                
                const confAEventsToday = eventsForDate.filter(e => e.room && e.room.includes('Conference Room A'));
                console.log(`üìç ConfA events for ${targetDate}:`, confAEventsToday.map(e => `"${e.summary}" in "${e.room}"`));
                
                // Generate time slots from 8 AM to 8 PM
                const timeSlots = [];
                for (let hour = 8; hour <= 20; hour++) {
                    const hour12 = hour > 12 ? hour - 12 : hour;
                    const ampm = hour >= 12 ? 'PM' : 'AM';
                    const displayHour = hour12 === 0 ? 12 : hour12;
                    timeSlots.push({
                        hour24: hour,
                        display: `${displayHour}:00 ${ampm}`
                    });
                }
                
                // Filter rooms
                const roomsToShow = selectedRoom ? [selectedRoom] : Array.from(this.rooms).sort();
                
                // Build the modern layout
                this.dayView.innerHTML = '';
                
                // Time slots header
                const headerContainer = document.createElement('div');
                headerContainer.className = 'time-header-modern';
                
                const timeSlotsHeader = document.createElement('div');
                timeSlotsHeader.className = 'time-slots-header';
                timeSlots.forEach(timeObj => {
                    const slot = document.createElement('div');
                    slot.className = 'time-slot-header';
                    slot.textContent = timeObj.display;
                    timeSlotsHeader.appendChild(slot);
                });
                headerContainer.appendChild(timeSlotsHeader);
                this.dayView.appendChild(headerContainer);
                
                // Rooms grid
                const roomsGrid = document.createElement('div');
                roomsGrid.className = 'rooms-grid';
                
                console.log(`üè¢ ROOM RENDERING DEBUG:`);
                console.log(`Total rooms available:`, Array.from(this.rooms));
                console.log(`Rooms to show (filtered):`, roomsToShow);
                console.log(`Selected room filter:`, selectedRoom);
                
                roomsToShow.forEach(room => {
                    console.log(`üè† Processing room card: "${room}"`);
                    
                    // Check for ConfA events in this room
                    const confAEventsInRoom = eventsForDate.filter(event => 
                        event.room === room && event.room && event.room.includes('Conference Room A')
                    );
                    if (confAEventsInRoom.length > 0) {
                        console.log(`‚úÖ Found ${confAEventsInRoom.length} ConfA events in room "${room}":`, confAEventsInRoom.map(e => e.summary));
                    }
                    
                    const roomCard = document.createElement('div');
                    roomCard.className = 'room-card';
                    
                    // Calculate room occupancy for the day
                    const roomEvents = eventsForDate.filter(event => event.room === room);
                    const hasEvents = roomEvents.length > 0;
                    
                    if (hasEvents) {
                        roomCard.classList.add('has-events');
                    }
                    
                    // Room header with status
                    const roomHeader = document.createElement('div');
                    roomHeader.className = 'room-header';
                    
                    const roomNameDiv = document.createElement('div');
                    roomNameDiv.className = 'room-name';
                    
                    const roomIcon = document.createElement('span');
                    roomIcon.className = 'room-icon';
                    roomIcon.textContent = this.getRoomIcon(room);
                    
                    roomNameDiv.appendChild(roomIcon);
                    roomNameDiv.appendChild(document.createTextNode(room));
                    
                    const statusBadge = document.createElement('div');
                    statusBadge.className = 'room-status-badge';
                    
                    // Determine current room status
                    const now = new Date();
                    const currentlyBusy = this.isRoomAvailableAtTime(room, now) === false;
                    
                    if (currentlyBusy) {
                        statusBadge.className += ' room-status-busy';
                        statusBadge.textContent = 'In Use';
                    } else if (hasEvents) {
                        statusBadge.className += ' room-status-partial';
                        statusBadge.textContent = 'Partial';
                    } else {
                        statusBadge.className += ' room-status-available';
                        statusBadge.textContent = 'Available';
                    }
                    
                    roomHeader.appendChild(roomNameDiv);
                    roomHeader.appendChild(statusBadge);
                    roomCard.appendChild(roomHeader);
                    
                    // Room schedule
                    const roomSchedule = document.createElement('div');
                    roomSchedule.className = 'room-schedule';
                    
                    timeSlots.forEach(timeObj => {
                        const slotTime = new Date(this.currentDate);
                        slotTime.setHours(timeObj.hour24, 0, 0, 0);
                        
                        const event = this.findEventAtTime(room, slotTime, targetDate);
                        
                        const slotRow = document.createElement('div');
                        slotRow.className = 'time-slot-row';
                        
                        const timeDiv = document.createElement('div');
                        timeDiv.className = 'time-slot-time';
                        timeDiv.textContent = timeObj.display;
                        
                        const contentDiv = document.createElement('div');
                        contentDiv.className = 'time-slot-content';
                        
                        const statusDot = document.createElement('div');
                        statusDot.className = 'time-slot-status';
                        
                        const textDiv = document.createElement('div');
                        
                        if (event) {
                            statusDot.classList.add('status-busy');
                            textDiv.className = 'time-slot-event';
                            textDiv.textContent = event.summary;
                            slotRow.title = `${event.summary}\n${this.formatTime(event.startTime)} - ${this.formatTime(event.endTime)}`;
                        } else {
                            statusDot.classList.add('status-available');
                            textDiv.className = 'time-slot-free';
                            textDiv.textContent = 'Available';
                            slotRow.title = `${room} is available at ${timeObj.display}`;
                        }
                        
                        contentDiv.appendChild(statusDot);
                        contentDiv.appendChild(textDiv);
                        
                        slotRow.appendChild(timeDiv);
                        slotRow.appendChild(contentDiv);
                        
                        // Add click handler to show events for this time slot
                        slotRow.addEventListener('click', () => {
                            if (event) {
                                this.showEventDetails(event);
                            } else {
                                const allEventsAtTime = this.getAllEventsAtTime(slotTime, targetDate);
                                const timeStr = this.formatTime(slotTime);
                                this.showEventsModal(allEventsAtTime, `Events at ${timeStr}`);
                            }
                        });
                        
                        roomSchedule.appendChild(slotRow);
                    });
                    
                    roomCard.appendChild(roomSchedule);
                    roomsGrid.appendChild(roomCard);
                });
                
                this.dayView.appendChild(roomsGrid);
                console.log('Modern day view rendered successfully');
            }
            
            getRoomIcon(roomName) {
                if (!roomName) return 'üè¢';
                
                const name = roomName.toLowerCase();
                if (name.includes('conference')) return 'ü§ù';
                if (name.includes('great hall')) return 'üèõÔ∏è';
                if (name.includes('seminar')) return 'üë•';
                if (name.includes('auditorium')) return 'üé≠';
                if (name.includes('lab')) return 'üî¨';
                if (name.includes('office')) return 'üíº';
                return 'üè¢';
            }
            
            showEventDetails(event) {
                this.showEventsModal([event], 'Event Details');
            }
            
            renderWeekView() {
                const startOfWeek = new Date(this.currentDate);
                startOfWeek.setDate(this.currentDate.getDate() - this.currentDate.getDay());
                
                const selectedRoom = this.roomFilter.value;
                const roomsToShow = selectedRoom ? [selectedRoom] : Array.from(this.rooms).sort();
                
                this.weekView.innerHTML = '';
                
                // Header
                const emptyHeader = document.createElement('div');
                emptyHeader.className = 'time-header';
                emptyHeader.textContent = 'Room';
                this.weekView.appendChild(emptyHeader);
                
                // Day headers
                const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                for (let i = 0; i < 7; i++) {
                    const dayDate = new Date(startOfWeek);
                    dayDate.setDate(startOfWeek.getDate() + i);
                    
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'day-header';
                    dayHeader.innerHTML = `${dayNames[i]}<br>${dayDate.getDate()}`;
                    this.weekView.appendChild(dayHeader);
                }
                
                // Room rows
                roomsToShow.forEach(room => {
                    const roomName = document.createElement('div');
                    roomName.className = 'room-name';
                    roomName.textContent = room;
                    this.weekView.appendChild(roomName);
                    
                    for (let i = 0; i < 7; i++) {
                        const dayDate = new Date(startOfWeek);
                        dayDate.setDate(startOfWeek.getDate() + i);
                        
                        const dayEvents = this.getEventsForRoomAndDate(room, dayDate.toDateString());
                        
                        const dayCell = document.createElement('div');
                        dayCell.className = dayEvents.length > 0 ? 'day-cell has-events' : 'day-cell';
                        
                        if (dayEvents.length > 0) {
                            dayCell.innerHTML = `<div class="event-count">${dayEvents.length}</div>`;
                        } else {
                            dayCell.textContent = 'Free';
                        }
                        
                        // Add click handler to show events for this day
                        dayCell.addEventListener('click', () => {
                            const allDayEvents = this.getEventsForDate(dayDate.toDateString());
                            const dateStr = dayDate.toLocaleDateString();
                            this.showEventsModal(allDayEvents, `Events on ${dateStr}`);
                        });
                        
                        this.weekView.appendChild(dayCell);
                    }
                });
            }
            
            renderMonthView() {
                const firstDay = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth(), 1);
                const lastDay = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - startDate.getDay());
                
                this.monthView.innerHTML = '';
                
                // Month header
                const monthHeader = document.createElement('div');
                monthHeader.className = 'month-header';
                monthHeader.textContent = this.currentDate.toLocaleDateString('en', { month: 'long', year: 'numeric' });
                this.monthView.appendChild(monthHeader);
                
                // Weekdays
                const weekdays = document.createElement('div');
                weekdays.className = 'weekdays';
                ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
                    const weekday = document.createElement('div');
                    weekday.className = 'weekday';
                    weekday.textContent = day;
                    weekdays.appendChild(weekday);
                });
                this.monthView.appendChild(weekdays);
                
                // Calendar grid
                const calendarGrid = document.createElement('div');
                calendarGrid.className = 'calendar-grid';
                
                for (let week = 0; week < 6; week++) {
                    for (let day = 0; day < 7; day++) {
                        const currentDate = new Date(startDate);
                        currentDate.setDate(startDate.getDate() + (week * 7) + day);
                        
                        const dayEvents = this.getEventsForDate(currentDate.toDateString());
                        
                        const dayCell = document.createElement('div');
                        dayCell.className = 'calendar-day';
                        
                        if (currentDate.getMonth() !== this.currentDate.getMonth()) {
                            dayCell.classList.add('other-month');
                        }
                        
                        if (dayEvents.length > 0) {
                            dayCell.classList.add('has-events');
                        }
                        
                        dayCell.innerHTML = `
                            <div class="day-number">${currentDate.getDate()}</div>
                            <div class="day-events">${dayEvents.length > 0 ? `${dayEvents.length} events` : ''}</div>
                        `;
                        
                        // Add click handler to show events for this day
                        dayCell.addEventListener('click', () => {
                            const dateStr = currentDate.toLocaleDateString();
                            this.showEventsModal(dayEvents, `Events on ${dateStr}`);
                        });
                        
                        calendarGrid.appendChild(dayCell);
                    }
                }
                
                this.monthView.appendChild(calendarGrid);
            }
            
            findEventAtTime(room, slotTime, targetDate) {
                const matchingEvent = this.events.find(event => {
                    const roomMatch = event.room === room;
                    const dateMatch = event.startTime.toDateString() === targetDate;
                    const timeMatch = event.startTime <= slotTime && event.endTime > slotTime;
                    
                    // Debug for Batten Builds specifically
                    if (event.summary === 'Batten Builds') {
                        console.log(`Checking Batten Builds:
                            Room: "${event.room}" === "${room}" = ${roomMatch}
                            Date: ${event.startTime.toDateString()} === ${targetDate} = ${dateMatch}
                            Time: ${event.startTime.toLocaleTimeString()} <= ${slotTime.toLocaleTimeString()} && ${event.endTime.toLocaleTimeString()} > ${slotTime.toLocaleTimeString()} = ${timeMatch}
                            Overall match: ${roomMatch && dateMatch && timeMatch}`);
                    }
                    
                    // Debug for any Conference Room A events
                    if (event.room && event.room.includes('Conference Room A')) {
                        console.log(`üèõÔ∏è ConfA Event Debug - "${event.summary}":
                            Event room: "${event.room}"
                            Looking for room: "${room}"
                            Room match: ${roomMatch}
                            Date: ${event.startTime.toDateString()} === ${targetDate} = ${dateMatch}
                            Time: ${event.startTime.toLocaleTimeString()} <= ${slotTime.toLocaleTimeString()} && ${event.endTime.toLocaleTimeString()} > ${slotTime.toLocaleTimeString()} = ${timeMatch}
                            Overall match: ${roomMatch && dateMatch && timeMatch}`);
                    }
                    
                    // Debug when event is wrongly assigned to different room
                    if (event.room && event.room.includes('Conference Room A') && room.includes('Great Hall') && roomMatch) {
                        console.error(`‚ùå ROOM MISMATCH: ConfA event "${event.summary}" with room "${event.room}" matched to "${room}"`);
                    }
                    
                    return roomMatch && dateMatch && timeMatch;
                });
                
                return matchingEvent;
            }
            
            getAllEventsAtTime(slotTime, targetDate) {
                return this.events.filter(event => 
                    event.startTime.toDateString() === targetDate &&
                    event.startTime <= slotTime &&
                    event.endTime > slotTime
                );
            }
            
            getEventsForRoomAndDate(room, dateString) {
                return this.events.filter(event => 
                    event.room === room && event.startTime.toDateString() === dateString
                );
            }
            
            getEventsForDate(dateString) {
                const filtered = this.events.filter(event => {
                    const eventDateString = event.startTime.toDateString();
                    const matches = eventDateString === dateString;
                    
                    // Debug logging for the target date
                    if (dateString.includes('Aug 29 2025')) {
                        console.log(`Event: "${event.summary}" on ${eventDateString}, matches ${dateString}: ${matches}`);
                    }
                    
                    return matches;
                });
                
                console.log(`getEventsForDate(${dateString}) found ${filtered.length} events`);
                return filtered;
            }
            
            formatTime(date) {
                return date.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit', hour12: true });
            }
            
            showLoading(show) {
                this.loadingMsg.classList.toggle('hidden', !show);
            }
            
            showError(message) {
                this.errorMsg.textContent = message;
                this.errorMsg.classList.remove('hidden');
                this.showLoading(false);
            }
            
            showEventsModal(events, title) {
                this.modalTitle.textContent = title;
                this.eventList.innerHTML = '';
                
                if (events.length === 0) {
                    const noEvents = document.createElement('div');
                    noEvents.className = 'no-events';
                    noEvents.textContent = 'No events scheduled for this time';
                    this.eventList.appendChild(noEvents);
                } else {
                    events.forEach(event => {
                        const eventItem = document.createElement('li');
                        eventItem.className = 'event-item';
                        
                        eventItem.innerHTML = `
                            <div class="event-title">${event.summary}</div>
                            <div class="event-time">${this.formatTime(event.startTime)} - ${this.formatTime(event.endTime)}</div>
                            <div class="event-location">${event.location}</div>
                        `;
                        
                        this.eventList.appendChild(eventItem);
                    });
                }
                
                this.eventModal.classList.remove('hidden');
            }
            
            closeModal() {
                this.eventModal.classList.add('hidden');
            }
            
            showAvailableRoomsModal() {
                this.initializeSearchForm();
                this.availableRoomsModal.classList.remove('hidden');
            }
            
            performRoomSearch() {
                const searchDate = new Date(this.searchDate.value);
                const startTime = this.searchStartTime.value;
                const searchDateString = searchDate.toDateString();
                
                let endTime;
                if (this.searchDuration.value === 'custom') {
                    endTime = this.searchEndTime.value;
                } else {
                    const duration = parseInt(this.searchDuration.value);
                    const [startHour, startMinute] = startTime.split(':').map(Number);
                    const endHour = startHour + Math.floor(duration / 60);
                    const endMinute = startMinute + (duration % 60);
                    const finalEndHour = endHour + Math.floor(endMinute / 60);
                    const finalEndMinute = endMinute % 60;
                    endTime = `${finalEndHour.toString().padStart(2, '0')}:${finalEndMinute.toString().padStart(2, '0')}`;
                }
                
                // Create Date objects for the search time range
                const searchStartDateTime = new Date(searchDate);
                const [startHour, startMinute] = startTime.split(':').map(Number);
                searchStartDateTime.setHours(startHour, startMinute, 0, 0);
                
                const searchEndDateTime = new Date(searchDate);
                const [endHour, endMinute] = endTime.split(':').map(Number);
                searchEndDateTime.setHours(endHour, endMinute, 0, 0);
                
                console.log(`Searching for available rooms on ${searchDateString} from ${this.formatTime(searchStartDateTime)} to ${this.formatTime(searchEndDateTime)}`);
                
                const availableRooms = this.findAvailableRoomsInTimeRange(searchStartDateTime, searchEndDateTime, searchDateString);
                
                this.displaySearchResults(availableRooms, searchStartDateTime, searchEndDateTime);
            }
            
            findAvailableRoomsInTimeRange(startDateTime, endDateTime, dateString) {
                const availableRooms = [];
                
                Array.from(this.rooms).forEach(roomName => {
                    const isAvailable = this.isRoomAvailableInTimeRange(roomName, startDateTime, endDateTime, dateString);
                    if (isAvailable) {
                        availableRooms.push({ 
                            name: roomName,
                            nextEvent: this.getNextEventForRoom(roomName, endDateTime)
                        });
                    }
                });
                
                return availableRooms.sort((a, b) => a.name.localeCompare(b.name));
            }
            
            isRoomAvailableInTimeRange(roomName, startDateTime, endDateTime, dateString) {
                // Find any event in this room that overlaps with the requested time range
                const conflictingEvent = this.events.find(event => {
                    const roomMatch = event.room === roomName;
                    const dateMatch = event.startTime.toDateString() === dateString;
                    const timeOverlap = event.startTime < endDateTime && event.endTime > startDateTime;
                    
                    return roomMatch && dateMatch && timeOverlap;
                });
                
                return !conflictingEvent; // Room is available if there's no conflicting event
            }
            
            displaySearchResults(availableRooms, startDateTime, endDateTime) {
                this.availableRoomsList.innerHTML = '';
                
                if (availableRooms.length === 0) {
                    const noRoomsDiv = document.createElement('div');
                    noRoomsDiv.className = 'no-available-rooms';
                    noRoomsDiv.innerHTML = `
                        <p>üö´ No rooms are available for the selected time</p>
                        <p>${this.formatTime(startDateTime)} - ${this.formatTime(endDateTime)}</p>
                        <p style="margin-top: 15px; font-size: 0.9rem;">Try a different time or shorter duration.</p>
                    `;
                    this.availableRoomsList.appendChild(noRoomsDiv);
                } else {
                    // Add results header
                    const headerDiv = document.createElement('div');
                    headerDiv.style.cssText = 'text-align: center; padding: 15px; background: var(--bg-secondary); border-radius: 8px; margin-bottom: 15px; font-weight: 600; color: var(--text-primary);';
                    headerDiv.innerHTML = `
                        üìÖ ${availableRooms.length} room${availableRooms.length === 1 ? '' : 's'} available<br>
                        <span style="font-size: 0.9rem; font-weight: 400; color: var(--text-secondary);">
                            ${this.formatTime(startDateTime)} - ${this.formatTime(endDateTime)}
                        </span>
                    `;
                    this.availableRoomsList.appendChild(headerDiv);
                    
                    availableRooms.forEach(room => {
                        const roomDiv = document.createElement('div');
                        roomDiv.className = 'available-room-item';
                        
                        const nextEventText = room.nextEvent 
                            ? `Next: ${room.nextEvent.summary} at ${this.formatTime(room.nextEvent.startTime)}`
                            : 'Free for the rest of the day';
                        
                        roomDiv.innerHTML = `
                            <div class="room-info">
                                <div class="room-name-available">${room.name}</div>
                                <div class="room-status">
                                    <span class="room-status-icon"></span>
                                    Available for requested time
                                </div>
                                <div class="next-event">${nextEventText}</div>
                            </div>
                        `;
                        
                        // Add click handler to filter to this room
                        roomDiv.addEventListener('click', () => {
                            this.roomFilter.value = room.name;
                            this.render();
                            this.closeAvailableRoomsModal();
                        });
                        
                        this.availableRoomsList.appendChild(roomDiv);
                    });
                }
            }
            
            findAvailableRoomsNow() {
                const now = new Date();
                const availableRooms = [];
                
                // Check each room to see if it's currently free
                Array.from(this.rooms).forEach(roomName => {
                    const isCurrentlyFree = this.isRoomAvailableAtTime(roomName, now);
                    if (isCurrentlyFree) {
                        availableRooms.push({ name: roomName });
                    }
                });
                
                return availableRooms.sort((a, b) => a.name.localeCompare(b.name));
            }
            
            isRoomAvailableAtTime(roomName, targetTime) {
                const targetDateString = targetTime.toDateString();
                
                // Find any event in this room that overlaps with the target time
                const conflictingEvent = this.events.find(event => {
                    const roomMatch = event.room === roomName;
                    const dateMatch = event.startTime.toDateString() === targetDateString;
                    const timeOverlap = event.startTime <= targetTime && event.endTime > targetTime;
                    
                    return roomMatch && dateMatch && timeOverlap;
                });
                
                return !conflictingEvent; // Room is available if there's no conflicting event
            }
            
            getNextEventForRoom(roomName, fromTime) {
                const fromDateString = fromTime.toDateString();
                
                // Find the next event in this room after the given time
                const upcomingEvents = this.events
                    .filter(event => 
                        event.room === roomName && 
                        event.startTime.toDateString() === fromDateString &&
                        event.startTime > fromTime
                    )
                    .sort((a, b) => a.startTime - b.startTime);
                
                return upcomingEvents.length > 0 ? upcomingEvents[0] : null;
            }
            
            closeAvailableRoomsModal() {
                this.availableRoomsModal.classList.add('hidden');
            }
        }
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            new RoomDashboard();
        });
    </script>
</body>
</html>